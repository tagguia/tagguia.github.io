<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Teste de localização</title>

	<script src="jquery-2.1.3.js"></script>
	<link rel="stylesheet" href="css/main.css">
</head>
<body id="body">

	<input type="button" value="Me encontre!" class="button">

	<ul>
		<li><label for="cidade">Cidade: </label><h2 class="city"></h2></li>
		<li><label for="estado">Estado: </label><h2 class="state"></h2></li>
		<li><label for="pais">País: </label><h2 class="country"></h2></li>
	</ul>	


	<script>
	(function() {
		if('geolocation' in navigator){

			function returnResult(arrReturn){
				var cityStateCountry = arrReturn.split(", ");
				var city = cityStateCountry[0];
				var state = cityStateCountry[1];
				var country = cityStateCountry[2];

				var h2City = document.querySelector('.city');
				var h2State = document.querySelector('.state');
				var h2Country = document.querySelector('.country');

				h2City.innerHTML = city;					
				h2State.innerHTML = state;
				h2Country.innerHTML = country;
			}	

			function findMe(){
				navigator.geolocation.getCurrentPosition(function(geo){
					var latitude = geo.coords.latitude;
					var longitude = geo.coords.longitude;

					var url = "http://maps.googleapis.com/maps/api/geocode/json?latlng="+latitude+","+longitude+"&sensor=true";

					$.ajax({
						url: url,
						cashe: false,
						dataType: "json",
						beforeSend: function(){
							console.log("carregando");
						},
						error: function(){
							console.log("ocorreu um erro");
						},
						success: function(retorno){
									if(retorno.erro){
										console.log(retorno.erro);
									} else {
										var result = retorno['results'][3].formatted_address;
										
										returnResult(result);

									}
								}
					});

				});				
			}


			var button = document.querySelector('.button');
			button.addEventListener('click', findMe, false);
			
		} else {
			console.log("Seu navegador não suporta geolocalização");
		}	

	}());
	</script>
	
</body>
</html>